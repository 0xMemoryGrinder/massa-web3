<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset='utf-8'>
    <title>Websocket's Test</title>
    <script type='text/javascript' src='../../bundle.js'></script>

    <script>

        /*
        const wsClient = new window.WebSocket('wss://labnet.massa.net/api/websocket');

        wsClient.onclose = () => {
            console.log("on Close >>>>>>>>>> ", wsClient.url, wsClient.protocol, wsClient.readyState, wsClient.binaryType);
		};

		wsClient.onerror = (errorMessage) => {
            console.log("on error >>>>>>>>>> ", errorMessage, wsClient.url, wsClient.protocol, wsClient.readyState, wsClient.binaryType);
		};

		wsClient.onmessage = (data) => {
            console.log("on message >>>>>>>>>> ", data.data);
		};

        wsClient.onopen = (event) => {
            console.log("on open >>>>>>>>>> ", wsClient.url, wsClient.protocol, wsClient.readyState, wsClient.binaryType);

            wsClient.send(JSON.stringify({
                "jsonrpc": "2.0",
                "id": 1,
                "method": "subscribe_new_blocks_headers",
                "params": []
            }));


            setTimeout(() => {
                console.log("closing ws connection...", wsClient.bufferedAmount);
                wsClient.close()
                console.log("closed ws connection");
            }, 5000)
        };
        */

        
        const wsClient = new window.massa.WsSubscriptionClient({
            connectionUrl: window.massa.DefaultWsProviderUrls.LABNET,
            pingTimeoutMs: 10000
        });

        // bind various methods for handling common socket events
        wsClient.on(window.massa.WebsocketEvent.ON_CLOSED, () => {
            console.log("ws closed");
        });

        wsClient.on(window.massa.WebsocketEvent.ON_CLOSING, () => {
            console.log("ws closing");
        });

        wsClient.on(window.massa.WebsocketEvent.ON_CONNECTING, () => {
            console.log("ws connecting");
        });

        wsClient.on(window.massa.WebsocketEvent.ON_OPEN, () => {
            console.log("ws open");
        });

        wsClient.on(window.massa.WebsocketEvent.ON_PING, () => {
            console.log("ws ping");
        });

        wsClient.on(window.massa.WebsocketEvent.ON_ERROR, (errorMessage) => {
            console.error("ws error", errorMessage);
        });

        // connect to ws
        wsClient.connect().then(() => {
            console.log("Ws Connection successfully established!");

            // subscribe to new blocks
            wsClient.subscribeNewBlocks((newBlock) => {
                console.log("New Block Received", newBlock);
            })
        })
        .catch((ex) => {
            console.error("Error on calling ws connect", ex)
        })
        
    </script>

  </head>

  <body>
    <p>Massa Websockets Demo for Browser</p>
  </body>
</html>